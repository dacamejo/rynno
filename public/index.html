<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rynno Mobile Prototype</title>
    <link rel="manifest" href="/manifest.webmanifest" />
    <style>
      :root {
        color-scheme: light;
        --bg: #041423;
        --bg-soft: #11243f;
        --card: #f7f6f3;
        --text: #1f2a37;
        --muted: #536275;
        --accent: #e4b95c;
        --accent-2: #f7d58b;
        --chip: #dce4ee;
        --chip-selected: #14273f;
        --chip-selected-text: #f5f9ff;
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #172b4a, var(--bg));
        color: var(--text);
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        display: flex;
        justify-content: center;
        padding: 18px;
      }

      .app-shell {
        width: min(100%, 420px);
        display: grid;
        gap: 14px;
        padding-bottom: 32px;
      }

      .card {
        background: var(--card);
        border-radius: 24px;
        padding: 18px;
        box-shadow: 0 16px 35px rgba(0, 0, 0, 0.26);
      }

      .hero {
        color: #f8fafc;
        background: linear-gradient(160deg, #0f2037, #2f1c3d);
      }

      h1, h2, h3 { margin: 0 0 8px; }
      h1 { font-size: 1.72rem; line-height: 1.1; }
      h2 { font-size: 1.18rem; }
      p { margin: 0; }
      .muted { color: var(--muted); }
      .small { font-size: 0.86rem; }

      .stack { display: grid; gap: 12px; }
      .row { display: flex; gap: 8px; flex-wrap: wrap; }

      .button {
        border: 0;
        border-radius: 14px;
        padding: 12px 14px;
        font-weight: 700;
        font-size: 0.94rem;
        cursor: pointer;
      }

      .button-primary {
        background: var(--accent);
        color: #2f2210;
      }

      .button-secondary {
        background: #233850;
        color: #f8fafc;
      }

      .button-ghost {
        background: #dce4ee;
        color: #1f2a37;
      }

      .pill {
        display: inline-flex;
        align-items: center;
        border-radius: 999px;
        padding: 4px 10px;
        background: rgba(255, 255, 255, 0.14);
        font-size: 0.74rem;
      }

      .hidden { display: none !important; }

      .loader {
        height: 86px;
        border-radius: 16px;
        background: linear-gradient(90deg, #dfe7ef 20%, #f4f8fc 45%, #dfe7ef 70%);
        background-size: 200% 100%;
        animation: shimmer 1.2s linear infinite;
      }

      @keyframes shimmer {
        from { background-position: 200% 0; }
        to { background-position: -200% 0; }
      }

      .chip {
        border: 0;
        background: var(--chip);
        border-radius: 999px;
        min-height: 44px;
        padding: 10px 14px;
        font-weight: 600;
        cursor: pointer;
      }

      .chip[aria-pressed='true'] {
        background: var(--chip-selected);
        color: var(--chip-selected-text);
      }

      .toggle {
        width: 100%;
        border: 1px solid #c3cedd;
        border-radius: 12px;
        background: #fff;
        padding: 10px;
      }

      .track {
        background: #eff3f9;
        border-radius: 14px;
        padding: 10px;
      }

      .playlist-cover {
        width: 100%;
        max-height: 180px;
        object-fit: cover;
        border-radius: 14px;
        background: #dfe7ef;
      }

      .meta-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
      }

      .meta-item {
        background: #eff3f9;
        border-radius: 12px;
        padding: 8px;
      }

      .quality-tag {
        display: inline-flex;
        border-radius: 999px;
        padding: 2px 8px;
        margin-right: 4px;
        background: #d7e7ff;
        color: #153054;
        font-size: 0.72rem;
        font-weight: 600;
      }

      .quality-tag.warn {
        background: #fce8d2;
        color: #643b06;
      }

      .quality-tag.good {
        background: #d9f3e1;
        color: #0f4b28;
      }

      .live-region {
        min-height: 18px;
      }

      .button[aria-busy='true'] {
        position: relative;
        overflow: hidden;
      }

      .button[aria-busy='true']::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(120deg, transparent 25%, rgba(255, 255, 255, 0.48) 50%, transparent 75%);
        animation: shimmer 1s linear infinite;
      }

      .footer-nav { display: flex; gap: 10px; }
      .footer-nav button { flex: 1; }

      .status-good { color: #106333; }
      .status-note { color: #6b7280; }
    </style>
  </head>
  <body>
    <main class="app-shell">
      <section class="card hero stack">
        <span class="pill">Share ➜ Choose Rynno ➜ Get playlist</span>
        <h1>Your Swiss train journey, scored.</h1>
        <p>Share from SBB or Google Maps and get a curated soundtrack before departure.</p>
        <div class="row">
          <button class="button button-primary" id="simulate-share">Share from SBB / Google</button>
          <a class="button button-secondary" href="/share-target">Open share target</a>
        </div>
      </section>

      <section class="card stack hidden" id="loader-card" aria-live="polite">
        <h2>Decoding your Lausanne → Zermatt magic...</h2>
        <div class="loader"></div>
        <p class="small muted">Extracting route legs, timing, and vibe cues.</p>
      </section>

      <section class="card stack hidden" id="trip-review">
        <h2>Trip review</h2>
        <p class="muted" id="trip-summary">No trip loaded yet.</p>
        <div class="stack">
          <h3>Companions</h3>
          <div class="row" id="companion-chips"></div>
          <label for="language-select"><strong>Language preference</strong></label>
          <select id="language-select" class="toggle">
            <option value="english">English</option>
            <option value="swiss german">Swiss German</option>
            <option value="german">German</option>
            <option value="french">French</option>
            <option value="italian">Italian</option>
          </select>

          <label for="region-select"><strong>Region flavor</strong></label>
          <select id="region-select" class="toggle">
            <option value="alps">Alps</option>
            <option value="lake">Lake</option>
            <option value="city">City</option>
            <option value="mixed">Mixed Switzerland</option>
          </select>
        </div>

        <div class="stack">
          <label for="mood-input"><strong>Mood notes</strong></label>
          <input id="mood-input" class="toggle" placeholder="e.g., calm sunrise, cozy, adventurous" />
          <p class="small muted" id="preference-summary">You’re generating: Solo · English · Alps · Open mood.</p>
          <p class="small muted" id="validation-hints">Tip: connect Spotify before generation to avoid auth errors.</p>
        </div>

        <div class="row">
          <button class="button button-primary" id="regenerate-playlist">Generate playlist</button>
          <button class="button button-ghost" id="refresh-trip">Refresh trip timing</button>
          <button class="button button-ghost" id="schedule-reminder">Schedule reminder</button>
        </div>
        <p class="small muted live-region" id="trip-action-status" role="status" aria-live="polite">Awaiting action.</p>
      </section>

      <section class="card stack hidden" id="playlist-panel">
        <img id="playlist-cover" class="playlist-cover hidden" alt="Generated playlist cover" />
        <h2 id="playlist-title">Playlist output</h2>
        <p class="muted" id="playlist-message" aria-live="polite">Ready to generate when you are.</p>
        <p class="small muted" id="playlist-meta">No generated playlist yet.</p>
        <div id="playlist-story" class="small muted">Generate a playlist to see trip storytelling details.</div>
        <div class="meta-grid" id="playlist-quality-meta"></div>
        <div class="row" id="playlist-ctas">
          <a class="button button-secondary hidden" id="open-spotify-link" target="_blank" rel="noreferrer">Open in Spotify</a>
          <button class="button button-ghost hidden" id="copy-playlist-link" type="button">Copy link</button>
          <a class="button button-ghost hidden" id="email-playlist-link">Email playlist</a>
        </div>
        <p class="small muted" id="playlist-cta-status"></p>
        <div class="stack" id="playlist-tracks"></div>
      </section>

      <section class="card stack" id="settings-history">
        <h2>Settings & history</h2>
        <p class="small" id="sw-status">Registering service worker…</p>
        <p class="small" id="spotify-status">Spotify auth: Not connected</p>
        <p class="small status-note" id="spotify-token-note">Spotify uses short-lived access tokens behind the scenes and renews them automatically.</p>
        <div id="spotify-profile" class="row hidden" aria-live="polite">
          <img id="spotify-avatar" alt="Spotify profile avatar" width="36" height="36" style="border-radius: 999px; object-fit: cover" />
          <p class="small"><strong id="spotify-display-name">Not connected</strong><br /><span class="muted" id="spotify-account-id"></span></p>
        </div>
        <label class="small" for="spotify-user-id"><strong>Rynno user id</strong></label>
        <input class="toggle" id="spotify-user-id" placeholder="demo-user-123" />
        <button class="button button-secondary" id="open-oauth">Connect Spotify</button>

        <div>
          <h3>Recent journeys</h3>
          <div class="track">Bern → Interlaken <span class="small">· Cinematic Calm</span></div>
          <div class="track">Geneva → Zürich <span class="small">· Focus Rail</span></div>
        </div>
      </section>
    </main>

    <script src="/app.js"></script>
  </body>
</html>
